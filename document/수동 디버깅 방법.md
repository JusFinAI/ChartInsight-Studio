# ChartInsight Studio Backend ìˆ˜ë™ ë””ë²„ê¹… ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” WSL2 í™˜ê²½ì—ì„œ FastAPI Backendë¥¼ ë””ë²„ê¹…í•˜ëŠ” ì™„ì „í•œ ë‹¨ê³„ë³„ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ¯ ëª©í‘œ
- Backend ì½”ë“œì— ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¥¼ ì„¤ì •í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ë””ë²„ê¹…
- Frontendë‚˜ curl ìš”ì²­ì„ í†µí•´ API í˜¸ì¶œ ì‹œ ì½”ë“œ ì‹¤í–‰ì„ ë‹¨ê³„ë³„ë¡œ ì¶”ì 
- Debug Consoleì—ì„œ ë³€ìˆ˜ ê°’ í™•ì¸ ë° ì½”ë“œ ì‹¤í–‰

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™
```bash
cd ~/ChartInsight-Studio
pwd  # í˜„ì¬ ìœ„ì¹˜ í™•ì¸: /home/jscho/ChartInsight-Studio ì¶œë ¥ë˜ì–´ì•¼ í•¨
```

### 2. í•„ìš”í•œ Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰
Backend ë””ë²„ê¹…ì„ ìœ„í•´ì„œëŠ” PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```bash
# í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# PostgreSQL ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (ì—†ëŠ” ê²½ìš°)
docker compose up -d postgres-tradesmart

# ì‹¤í–‰ í™•ì¸ (postgres-tradesmartê°€ "Up" ìƒíƒœì—¬ì•¼ í•¨)
docker ps | grep postgres-tradesmart
```

**ì˜ˆìƒ ì¶œë ¥:**
```
eadbed7e7cfb   postgres:15   "docker-entrypoint.sâ€¦"   Up 2 minutes (healthy)   0.0.0.0:5433->5432/tcp   postgres-tradesmart
```

## ğŸš€ ë””ë²„ê¹… ì‹œì‘í•˜ê¸°

### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
Backendê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê¸° ìœ„í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```bash
# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export DATABASE_URL="postgresql+psycopg2://tradesmart_db:1234@localhost:5433/tradesmart_db"

# ì„¤ì • í™•ì¸
echo $DATABASE_URL
# ì¶œë ¥: postgresql+psycopg2://tradesmart_db:1234@localhost:5433/tradesmart_db
```

### 4. Backend ë””ë ‰í† ë¦¬ë¡œ ì´ë™
```bash
cd backend
pwd  # í˜„ì¬ ìœ„ì¹˜ í™•ì¸: /home/jscho/ChartInsight-Studio/backend
```

### 5. ê°€ìƒí™˜ê²½ ë° debugpy í™•ì¸
```bash
# ê°€ìƒí™˜ê²½ Python ì‹¤í–‰ íŒŒì¼ í™•ì¸
ls -la venv/bin/python*

# debugpy ì„¤ì¹˜ í™•ì¸
./venv/bin/pip show debugpy | head -5
```

**ì˜ˆìƒ ì¶œë ¥:**
```
Name: debugpy
Version: 1.8.16
Summary: An implementation of the Debug Adapter Protocol for Python
```

### 6. Backend ì„œë²„ë¥¼ ë””ë²„ê¹… ëª¨ë“œë¡œ ì‹¤í–‰

ì´ ëª…ë ¹ì–´ëŠ” ì„œë²„ë¥¼ ì‹¤í–‰ ëª¨ë“œë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. 

```bash
uvicorn app.main:app --reload --port 8000
```

ì´ ëª…ë ¹ì–´ëŠ” ì„œë²„ë¥¼ ë””ë²„ê¹… ëª¨ë“œë¡œ ì‹œì‘í•˜ê³  ë””ë²„ê±° ì—°ê²°ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.

```bash
./venv/bin/python -Xfrozen_modules=off -m debugpy --listen 5680 --wait-for-client -m uvicorn app.main:app --host 127.0.0.1 --port 8000
```

**ëª…ë ¹ì–´ ì„¤ëª…:**
- `-Xfrozen_modules=off`: ë””ë²„ê¹…ì„ ìœ„í•œ Python ìµœì í™” ë¹„í™œì„±í™”
- `-m debugpy --listen 5680`: 5680 í¬íŠ¸ì—ì„œ ë””ë²„ê±° ì—°ê²° ëŒ€ê¸°
- `--wait-for-client`: ë””ë²„ê±°ê°€ ì—°ê²°ë  ë•Œê¹Œì§€ ì„œë²„ ì‹œì‘ì„ ëŒ€ê¸°
- `-m uvicorn app.main:app`: FastAPI ì•± ì‹¤í–‰

**ì‹¤í–‰ í›„ ìƒíƒœ:** í„°ë¯¸ë„ì´ ë©ˆì¶˜ ìƒíƒœë¡œ ëŒ€ê¸°í•©ë‹ˆë‹¤. ì´ê²ƒì´ ì •ìƒì…ë‹ˆë‹¤!

### 7. ë””ë²„ê±° ì—°ê²° ìƒíƒœ í™•ì¸ (ìƒˆ í„°ë¯¸ë„ì—ì„œ)
**ìƒˆ í„°ë¯¸ë„ íƒ­/ì°½ì„ ì—´ê³ ** ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

```bash
# 5680 í¬íŠ¸ê°€ LISTEN ìƒíƒœì¸ì§€ í™•ì¸
ss -ltn | grep 5680
```

**ì˜ˆìƒ ì¶œë ¥:**
```
LISTEN 0      4096       127.0.0.1:5680       0.0.0.0:*
```
ì´ ì¶œë ¥ì´ ë‚˜ì˜¤ë©´ ë””ë²„ê±°ê°€ ì—°ê²°ì„ ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

### 8. VS Code/Cursorì—ì„œ ë””ë²„ê±° ì—°ê²°

1. **Run and Debug íŒ¨ë„ ì—´ê¸°**
   - ì™¼ìª½ ì‚¬ì´ë“œë°”ì˜ ë²Œë ˆ ğŸ› ì•„ì´ì½˜ í´ë¦­
   - ë˜ëŠ” `Ctrl+Shift+D` ë‹¨ì¶•í‚¤ ì‚¬ìš©

2. **ë””ë²„ê±° êµ¬ì„± ì„ íƒ**
   - ìƒë‹¨ ë“œë¡­ë‹¤ìš´ì—ì„œ **"Attach to Backend (5680)"** ì„ íƒ

3. **ë””ë²„ê±° ì—°ê²°**
   - **F5** í‚¤ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ì´ˆë¡ìƒ‰ â–¶ï¸ ë²„íŠ¼ í´ë¦­
   - 2ì´ˆ í›„ ë””ë²„ê±°ê°€ ì—°ê²°ë©ë‹ˆë‹¤

4. **ì—°ê²° ì„±ê³µ í™•ì¸**
   - ì²« ë²ˆì§¸ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ë©´ ì„±ê³µ:
   ```
   INFO:     Started server process [77715]
   INFO:     Waiting for application startup.
   INFO:     Application startup complete.
   INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
   ```

## ğŸ” ë””ë²„ê¹… í…ŒìŠ¤íŠ¸

### 9. ë¸Œë ˆì´í¬í¬ì¸íŠ¸ ì„¤ì •
1. `backend/app/routers/pattern_analysis.py` íŒŒì¼ ì—´ê¸°
2. 983ë²ˆ ì¤„ `if _is_korean_stock_code(symbol):` ë¶€ë¶„ ì°¾ê¸°
3. ì¤„ ë²ˆí˜¸ ì™¼ìª½ì„ í´ë¦­í•˜ì—¬ ë¹¨ê°„ ì (ë¸Œë ˆì´í¬í¬ì¸íŠ¸) ìƒì„±

### 10. Frontend ì‹¤í–‰ (ìƒˆ í„°ë¯¸ë„ì—ì„œ)
```bash
cd ~/ChartInsight-Studio/frontend
npm run dev
```

**ì‹¤í–‰ í™•ì¸:**
- ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000` ì ‘ì†
- Trading Radar í˜ì´ì§€ë¡œ ì´ë™
- í•œêµ­ ì£¼ì‹ íƒ­ì—ì„œ ì¢…ëª© ì„ íƒ (ì˜ˆ: ì‚¼ì„±ì „ì 005930)

### 11. API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ (ëŒ€ì•ˆ)
```bash
curl "http://localhost:8000/api/v1/pattern-analysis/trading-radar-data?symbol=005930&timeframe=5m&chart_type=candlestick&period=auto"
```

## ğŸ® ë””ë²„ê¹… ì»¨íŠ¸ë¡¤

ë¸Œë ˆì´í¬í¬ì¸íŠ¸ì—ì„œ ì‹¤í–‰ì´ ë©ˆì·„ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í‚¤:

- **F5** (Continue): ë‹¤ìŒ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ê¹Œì§€ ì‹¤í–‰
- **F10** (Step Over): í˜„ì¬ ì¤„ ì‹¤í–‰ í›„ ë‹¤ìŒ ì¤„ë¡œ ì´ë™
- **F11** (Step Into): í•¨ìˆ˜ í˜¸ì¶œì´ ìˆìœ¼ë©´ í•¨ìˆ˜ ë‚´ë¶€ë¡œ ë“¤ì–´ê°€ê¸°
- **Shift+F11** (Step Out): í˜„ì¬ í•¨ìˆ˜ì—ì„œ ë¹ ì ¸ë‚˜ì˜¤ê¸°

### Debug Console ì‚¬ìš©ë²•
ë¸Œë ˆì´í¬í¬ì¸íŠ¸ì—ì„œ ë©ˆì·„ì„ ë•Œ í•˜ë‹¨ì˜ Debug Consoleì—ì„œ Python ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥:

```python
# í˜„ì¬ ë³€ìˆ˜ ê°’ í™•ì¸
symbol
timeframe
period

# í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
_is_korean_stock_code(symbol)
_is_korean_stock_code("AAPL")

# DB ì—°ê²° ìƒíƒœ í™•ì¸
db
```

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### í¬íŠ¸ ì¶©ëŒ ë¬¸ì œ
```bash
# 8000ë²ˆ í¬íŠ¸ ì‚¬ìš© í”„ë¡œì„¸ìŠ¤ í™•ì¸
ss -ltn | grep 8000

# uvicorn í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
pkill -f uvicorn

# debugpy í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
pkill -f debugpy
```

### ë¹ ë¥¸ ë°±ì—”ë“œ ì‹¤í–‰ ë° ë””ë²„ê·¸ ìš”ì•½
ì•„ë˜ëŠ” ë””ë²„ê¹…ì„ ìœ„í•´ ìì£¼ ì‚¬ìš©í•˜ëŠ” ìµœì†Œ ëª…ë ¹ ëª¨ìŒì…ë‹ˆë‹¤.

```bash
cd backend
export DATABASE_URL="postgresql+psycopg2://tradesmart_db:1234@localhost:5433/tradesmart_db"

# ì¼ë°˜ ì‹¤í–‰
uvicorn app.main:app --reload --port 8000

# ë””ë²„ê±° ì—°ê²° ëŒ€ê¸° (debugpy)
./venv/bin/python -Xfrozen_modules=off -m debugpy --listen 5680 --wait-for-client -m uvicorn app.main:app --host 127.0.0.1 --port 8000

# ë””ë²„ê±° ë¦¬ìŠ¤ë‹ í™•ì¸
ss -ltn | grep 5680

# í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
cd ~/ChartInsight-Studio/frontend
npm run dev
```

### í™˜ê²½ ë³€ìˆ˜ ë¬¸ì œ
```bash
# í˜„ì¬ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
env | grep DATABASE_URL

# ë‹¤ì‹œ ì„¤ì •
export DATABASE_URL="postgresql+psycopg2://tradesmart_db:1234@localhost:5433/tradesmart_db"
```

### PostgreSQL ì—°ê²° ë¬¸ì œ
```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps | grep postgres-tradesmart

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart postgres-tradesmart
```

## ğŸ›‘ ë””ë²„ê¹… ì¢…ë£Œ

1. **ì„œë²„ ì¤‘ì§€**: ì²« ë²ˆì§¸ í„°ë¯¸ë„ì—ì„œ `Ctrl+C`
2. **ë””ë²„ê±° ì—°ê²° í•´ì œ**: VS Code/Cursorì—ì„œ ë¹¨ê°„ ì •ì‚¬ê°í˜• â¹ï¸ ë²„íŠ¼ í´ë¦­
3. **Frontend ì¤‘ì§€**: Frontend í„°ë¯¸ë„ì—ì„œ `Ctrl+C`

## ğŸ“ ì°¸ê³ ì‚¬í•­

- ì´ ë°©ë²•ì€ **ìˆ˜ë™ ë””ë²„ê¹…**ìœ¼ë¡œ, ë§¤ë²ˆ í„°ë¯¸ë„ì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤
- ìë™ ë””ë²„ê¹…(Run & Debug ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ì‹¤í–‰)ì„ ì›í•œë‹¤ë©´ `launch.json`ê³¼ `tasks.json` ì„¤ì •ì„ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤
- ë””ë²„ê¹… ì¤‘ì—ëŠ” API ì‘ë‹µì´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì •ìƒì ì¸ í˜„ìƒ)

---
*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025ë…„ 1ì›”*